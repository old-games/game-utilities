Файл графики .CMP игры DRAGON STRIKE устроен так:
+0 DW размер тела файла -2 или он же -3
+2 DB метод сжатия
+4 ... тело файла
Тело файла представляет собой простой образ видеопамяти в сжатом виде.
Метод сжатия бывает 3, 6 или любой другой (используется значение 4).
Методы сжатия 3 и 6 - это реализации LZW-метода, которые получили бы первый
приз за идиотизм, если бы приз этот уже не принадлежал второй Аркании.
При использовании этих методов, первое слово тела файла - это размер его тела в
распакованном виде, сжатые данные начинаются по смещению 2 в теле файла.
Для метода 3, коды по 12 бит, размер таблицы 1000h кодов; кодов очистки и конца
информации нет, так что коды сжатия начинаются со 100h.
Для метода 6, все так же, но коды по 14 бит и размер таблицы 4000h кодов.
Выборка кодов идет со _старших_ битов и с младших адресов (!), так что входной
поток переводится в выходной так:
метод 3:
 байты:   AB CD EF
 выборки: 0ABC 0DEF
метод 6:
 байты:   abcd efgh ijkl mnop qrst uvwx yz@#
 выборки: 0abcdefg 0hijklmn 0opqrstu 0vwxyz@#
Описывать здесь сам LZW-метод я счел неуместным - так что RTFM.
Метод сжатия 4 - это блочный RLE-метод. Блоки устроены так:
блок длинного заполнения:
+0 DB 0
+1 DB 0XYh,0ZTh
+3 DB цвет, по нему заполняются 0XYZTh точек
блок копирования:
+0 DB N (N>0 как байт со знаком)
+1 DB N байт изображения
блок короткого заполнения
+0 DB N (N<0 как байт со знаком)
+1 DB цвет, по нему заполняются (-N) точек

Вот,собственно,и все...
