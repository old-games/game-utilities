Файл графических ресурсов RESOURCE. игры THE SUMMONING устроен так:
+0 DD число ресурсов в файле
+4 DD смещение в файле 1-го ресурса
+8 ...
Ресурс устроен так:
+0 DB 'EH' (идентификатор)
+2 DB тип (возможен 1,2,3 и 5, тип 5 не использовался, тип 3 не графический)
+3 DW длина 2-го заголовка (=X)
+5 ... (2-й заголовок)
2-й заголовок устроен так (для типов 1 и 2):
+0 ...
+X-7 DW число картинок в теле ресурса
+X-5 DB число строк в картинке
+X-4 DB число столбцов в картинке, деленное на 8
+X-3 DB прозрачный цвет (обычно 0FEh, если 0FFh - прозрачного цвета нет)
+X-2 DB модификация (обычно 3, очень редко 2)
+X-1 DB 0
+X ... (тело ресурса)
Тело ресурса модификации 3 устроено так:
это изображение, хранящееся по строкам и по картинкам, раскодируемое по
следующей схеме LZ-метода:
Кольцевой буфер раскодировки имеет длину 1000h байт и инициализируется кодом
0FEh в количестве 0FEEh штук; раскодировка производится следующим образом:
извлекается флаговый байт, каждый бит которого означает: для 1, извлечь оче-
редной байт, поместить его в выходное изображение и в конец буфера; для 0,
извлечь слово, трактуемое как XYZTh и поместить в выходное изображение и в
конец буфера по одному (Y+3) байт начиная со смещения 0XZTh в буфере; по ис-
черпании битов флагового байта, извлечь новый флаговый байт. Раскодировка
прерывается в момент, когда в выходное изображение помещено сколько нужно
байт (число столбцов*число строк*число картинок).
Крупные изображения хранятся так, что каждая строка считается отдельной кар-
тинкой, так что если число строк в картинке = 1, то следует поменять местами
число строк с числом картинок.
Только и всего...