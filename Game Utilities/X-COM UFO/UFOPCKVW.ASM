cseg	segment	para public 'code'
	assume	cs:cseg,ds:cseg,ss:cseg
	include	parse.asm
	org	100h
;This silly little program views UFO's .PCK files. It has such a lack of
;features that I hate to put my copyleft onto it, but it works (sometimes)...
;It was written by White Jaguar.
start:	parse	nm1
	mov	dx,nm1
	mov	ax,3D00h
	int	21h
	jnc	m1
	int	20h
m1:	xchg	ax,bx
	mov	ax,cs
	add	ax,1000h
	mov	ds,ax
	mov	ah,3Fh
	mov	cx,0FFFFh
	xor	dx,dx
	int	21h
	push	ax
	mov	ah,3Eh
	int	21h
	mov	ax,13h
	int	10h
	push	cs
	pop	es
	mov	ax,1012h
	xor	bx,bx
	mov	cx,256
	mov	dx,offset pbf
	int	10h
	pop	dx
	mov	ax,ds
	add	ax,1000h
	mov	es,ax
	mov	si,1
	mov	bx,32
	push	ds
	push	es
mmm:	pop	es
	pop	ds
	xor	di,di
	mov	ah,0
	cmp	si,dx
	jb	ml
	jmp	mqq
ml:	lodsb
	cmp	al,0FFh
	je	mlq
	cmp	al,0FEh
	jne	m2
	lodsb
	mov	cx,ax
	mov	al,0
	rep	
m2:	stosb
	jmp	short ml
mlq:	push	ds
	push	es
	push	si
	push	dx
	mov	dx,di
	push	es
	pop	ds
	mov	ax,0A000h
	mov	es,ax
	xor	si,si
	mov	di,si
mrp:	mov	cx,bx
	rep	movsb
	add	di,320
	sub	di,bx
	cmp	dx,si
	ja	mrp
	mov	ah,0
	int	16h
	cmp	al,27
	je	mqq
	xor	ax,ax
	mov	di,ax
	mov	cx,32000
	rep	stosw
	pop	dx
	pop	si
	jmp	short mmm
mqq:	mov	ax,3
	int	10h
	int	20h
;this for UFO 1
pbf	db	0,0,0,63,63,63,58,58,58,54,54,54,49,49,49,44,44,44,40,40,40
	db	35,35,35,31,31,31,26,26,26,22,22,22,17,17,17,13,13,13,8,8,8
	db	3,3,3,0,0,0,63,52,0,59,45,0,56,40,0,52,34,0,49,29,0,45
	db	24,0,42,20,0,38,16,0,35,13,0,31,9,0,28,7,0,24,4,0,21,2
	db	0,18,1,0,14,0,0,11,0,0,63,30,30,59,26,26,56,23,23,52,19,19
	db	49,17,17,46,14,14,42,11,11,39,9,9,35,7,7,32,5,5,29,3,3,25
	db	2,2,22,1,1,18,0,0,15,0,0,12,0,0,40,56,33,34,52,29,29,49
	db	25,23,46,21,18,43,18,15,40,16,12,36,15,10,33,14,7,30,14,5,27,13
	db	4,24,12,2,20,11,1,17,10,0,14,9,0,11,7,0,8,6,52,57,24,46
	db	53,21,41,49,18,36,46,15,31,42,12,26,39,10,22,35,8,18,31,6,14,28
	db	5,10,24,3,7,21,2,4,17,1,2,13,0,1,10,0,0,6,0,0,3,0
	db	62,62,62,58,56,56,55,52,51,51,47,46,48,43,42,44,39,37,41,35,33,37
	db	31,29,34,27,25,30,23,22,27,20,18,23,17,15,20,14,12,17,11,10,13,8
	db	7,10,6,5,60,49,18,56,44,16,53,39,13,50,34,12,47,30,10,44,26,8
	db	40,21,6,37,18,5,34,14,4,31,11,3,28,8,2,24,5,1,21,3,1,18
	db	1,0,15,0,0,12,0,0,35,44,50,32,40,47,28,36,44,26,32,41,23,28
	db	38,20,25,36,18,21,33,15,18,30,13,15,27,11,12,24,9,9,22,8,7,19
	db	7,6,16,6,4,13,5,3,10,4,2,8,42,52,60,37,47,56,32,43,53,28
	db	38,50,24,34,47,20,30,43,16,26,40,13,22,37,10,18,33,7,15,30,5,12
	db	27,3,9,24,2,6,20,1,4,17,0,2,14,0,1,11,63,63,30,59,57,26
	db	56,51,23,52,46,19,49,40,17,46,35,14,42,30,11,39,25,9,35,20,7,32
	db	16,5,29,12,3,25,8,2,22,5,1,18,2,0,15,1,0,12,0,0,46,40
	db	22,43,36,19,40,32,16,37,28,14,34,24,11,31,20,9,28,17,7,26,14,6
	db	23,11,4,20,8,3,17,5,2,14,3,1,11,2,0,8,1,0,5,0,0,3
	db	0,0,62,55,53,58,49,48,55,44,43,52,38,38,48,34,35,45,30,32,42,26
	db	30,38,23,27,35,19,25,32,16,23,28,13,21,25,11,19,22,8,17,18,6,15
	db	15,4,13,12,3,11,54,49,63,50,43,59,46,37,56,43,32,52,40,27,49,38
	db	23,45,35,19,42,33,15,38,31,12,35,29,9,31,27,6,28,24,4,24,21,2
	db	20,18,1,15,14,0,11,11,0,8,16,49,63,14,43,59,12,37,56,10,32,52
	db	8,27,49,7,22,46,6,18,42,4,13,39,3,10,35,2,6,32,1,4,29,1
	db	1,25,1,0,22,1,0,18,2,0,15,2,0,12,59,59,62,54,54,58,49,49
	db	55,45,45,52,41,41,48,37,36,45,34,33,42,30,29,38,27,25,35,24,22,32
	db	21,19,28,18,16,25,15,13,22,13,10,18,10,8,15,8,6,12,39,40,40,35
	db	37,37,32,34,35,29,31,32,26,29,30,23,26,27,21,23,25,18,20,22,15,17
	db	20,13,14,17,11,12,15,9,9,12,6,7,10,5,5,7,3,3,5,35,31,29
;This for UFO 2
;pbf	db	0,0,0,63,63,63,56,56,56,47,47,53,33,33,44,20,27,36,18,26,36
;	db	5,5,24,0,0,0,63,6,6,54,4,4,45,3,3,35,2,2,26,0,0
;	db	48,0,0,0,0,0,63,62,3,59,58,2,55,54,2,51,51,2,48,47,2
;	db	44,43,1,40,40,1,36,36,1,33,32,1,29,28,1,25,25,1,21,21,1
;	db	13,18,0,5,13,0,0,8,0,0,4,2,63,63,49,59,59,46,55,55,43
;	db	51,51,40,48,48,37,44,44,34,40,40,31,36,36,28,33,33,25,29,29,22
;	db	25,25,19,21,21,16,16,18,13,12,15,11,8,11,8,3,5,5,63,63,63
;	db	59,59,59,55,55,55,51,51,51,48,48,48,44,44,44,40,40,40,36,36,36
;	db	33,33,33,29,29,29,25,25,25,21,21,21,18,18,18,14,14,14,10,10,10
;	db	6,6,6,38,30,13,35,28,12,33,26,11,31,24,10,29,22,9,26,20,9
;	db	24,19,8,22,17,7,19,15,6,17,13,5,14,10,4,12,7,4,10,5,3
;	db	7,4,3,5,2,2,3,1,1,47,63,17,44,59,16,41,55,15,38,51,13
;	db	35,48,12,33,44,11,30,40,10,27,36,9,24,33,8,21,29,7,19,25,6
;	db	16,21,5,9,18,3,1,13,0,0,8,3,0,3,5,12,63,44,11,59,41
;	db	10,55,38,9,51,36,9,48,33,8,44,30,7,40,28,6,36,25,6,33,23
;	db	5,29,20,4,25,17,3,21,8,1,18,2,5,15,1,8,10,0,6,3,0
;	db	8,0,0,3,5,0,0,2,1,0,2,1,0,2,1,0,1,1,0,1,0
;	db	0,1,0,0,1,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0
;	db	0,0,0,0,0,0,63,54,0,59,50,0,55,47,0,51,44,0,48,41,0
;	db	44,38,0,40,36,0,36,34,0,32,31,0,27,28,0,21,25,0,16,21,0
;	db	12,18,0,8,15,0,4,11,0,1,8,0,63,63,30,59,57,26,56,51,23
;	db	52,46,19,44,43,1,38,38,1,32,33,1,26,28,0,20,23,0,13,18,0
;	db	61,26,0,39,17,0,24,10,0,46,31,51,35,16,41,20,10,23,63,43,2
;	db	59,40,1,55,37,1,51,35,1,48,32,1,44,30,1,40,27,1,36,25,1
;	db	33,22,1,29,19,1,25,17,0,21,14,0,18,15,0,15,13,0,8,9,0
;	db	2,6,0,61,22,0,57,20,0,53,19,0,50,18,0,46,16,0,42,15,0
;	db	39,14,0,35,12,0,32,11,0,28,9,0,24,8,0,21,7,0,18,6,0
;	db	15,6,0,12,5,0,9,4,0,59,61,63,52,54,56,46,48,50,40,42,44
;	db	34,36,38,28,29,32,22,24,26,17,18,20,15,16,18,13,14,15,11,12,13
;	db	10,10,11,8,8,9,6,6,7,3,5,6,1,5,3,58,40,31,54,37,29
;	db	51,35,27,47,32,25,44,30,23,40,28,21,37,25,19,33,23,17,30,20,16
;	db	27,18,14,23,16,12,20,14,9,19,12,7,16,10,5,14,9,3,12,8,2
;	db	60,40,46,56,37,43,52,35,40,49,33,37,45,30,35,42,28,32,38,25,29
;	db	35,23,26,31,21,24,27,18,21,24,16,18,20,13,15,17,11,13,14,9,13
;	db	10,7,11,6,5,9,0,63,63,0,59,59,0,55,55,0,51,51,0,47,47
;	db	0,43,43,0,39,39,0,35,35,0,31,31,0,27,27,0,23,23,0,19,19
;	db	0,15,15,0,12,12,0,9,9,0,10,34
nm1	dw	?
cseg	ends
end	start