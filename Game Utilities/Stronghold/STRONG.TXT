Файл ресурсов STRONG.DAT игры Stronghold устроен так:
+0 DD смещение "директории"
+4 ... 1-й ресурс
+? ... "директория"
"Директория" идет до конца файла и состоит из 21-байтовых элементов.
Элемент "директории" устроен так:
+0 DB 0
+1 DD смещение ресурса в файле
+5 DD размер ресурса
+9 DB*12 0
Графические ресурсы, содержащиеся в файле, подразделяются на 5 типов.
Ресурс первого типа устроен так:
+0 DB 1
+1 DD размер тела ресурса
+5 DW ширина картинки
+7 DW высота картинки
+9 ... тело ресурса
Ресурс второго типа устроен так:
+0 DB 2
+1 DW смещение по X?
+3 DW смещение по Y?
+5 DB 1
+6 DD размер тела ресурса
+A DW ширина картинки
+C DW высота картинки
+E ... тело ресурса
Ресурс третьего типа устроен так:
+00 DB 4
+01 DD 0
+05 DB ???
+06 DB 2
+07 DW смещение по X?
+09 DW смещение по Y?
+0B DB 1
+0С DD размер тела ресурса
+10 DW ширина картинки
+12 DW высота картинки
+14 ... тело ресурса
Тело ресурса этих типов представляет собой простой битмап (0 может быть
прозрачным цветом), сжатый блочным RLE-методом. Состоит оно, естественно, из
блоков. Блоки устроены так:
блок копирования:
+0 DB X (как байт со знаком, >0)
+1 DB (X+1) байт изображения, по нему они копируются на экран
блок заполнения:
+0 DB -X (как байт со знаком, <0)
+1 DB цвет, по нему (X+1) точек закрашиваются этим цветом
пустышка:
+0 DB 80h, такой блок просто пропускается
Ресурсы четвертого типа представляют собой не отдельные картинки, а анимацион-
ные последовательности; их в файле содержится 2. Они состоят из заголовка и
набора страниц; страницы состоят из заголовка и одного или двух элементов.
Заголовок последовательности устроен так:
+00 DD размер _всего_ ресурса
+04 DW 0AF11h (сигнатура)
+06 DW число страниц-1
+08 DW ширина картинок (всегда 320)
+0A DW высота картинок (всегда 200)
+0C DW 8
+0E DW 0
+10 DW 6
+12 DW 0
+14 DW 0
+16 DW 100h
+18 DW*52 0
+80 ... 1-я страница
Заголовок страницы устроен так:
+00 DD размер всей страницы
+04 DW 0F1FAh (сигнатура)
+06 DW число элементов в странице
+08 DW*4 0
+10 ... 1-й элемент
Элемент страницы устроен так:
+0 DD размер всего элемента
+4 DW тип элемента
+6 ... тело элемента
Допустимые типы элементов - это 0Bh, 0Ch, 0Dh, 0Fh и 10h.
Элемент типа 0Bh - палитра. Его тело устроено так:
+0 DW число блоков палитры в элементе
+2 DB число пропускаемых цветов перед 1-м блоком
+3 DB число цветов в 1-м блоке (значение 0 соответствует 256 цветам)
+4 DB*3*? RGB-составляющие цветов блока
+? ... так же для остальных блоков
Элемент типа 0Ch - очередной лист анимации. Его тело состоит из заголовка и
набора строк изображения. Строки состоят из счетчика блоков и набора блоков
строки. Заголовок листа устроен так:
+0 DW собственный сдвиг листа вниз
+2 DW высота листа
+4 ... 1-я строка
Строка устроена так:
+0 DB счетчик блоков строки
+1 ... блоки
Блоки строки устроены так:
блок копирования:
+0 DB число пропускаемых точек перед блоком
+1 DB X (как байт со знаком, >0)
+2 DB X байт изображения, по нему они копируются на экран
блок заполнения:
+0 DB число пропускаемых точек перед блоком
+1 DB -X (как байт со знаком, <0)
+2 DB цвет, по нему X точек закрашиваются этим цветом
Элемент типа 0Dh вызывает очистку экрана. Тела он не имеет.
Элемент типа 0Fh - базовый лист анимации. Его тело содержит 200 строк изображе-
ния. Строки состоят из счетчика блоков и набора блоков строки.
Строка устроена так:
+0 DB счетчик блоков строки
+1 ... блоки
Блоки строки устроены так:
блок копирования:
+0 DB -X (как байт со знаком, <0)
+1 DB X байт изображения, по нему они копируются на экран
блок заполнения:
+0 DB X (как байт со знаком, >0)
+1 DB цвет, по нему X точек закрашиваются этим цветом
Элемент типа 10h - полноэкранное несжатое изображение. Его тело - простой
битмап 320*200.
Ресурс пятого типа, единственный на весь файл, представляет собой пропорцио-
нальный шрифт. Он состоит из заголовка и набора символов.
Заголовок шрифта устроен так:
+000 DB 13 (высота шрифта?)
+001 DW*60h смещения символов _от_конца_заголовка_
+0C1 DB*60h размеры символов по X (X<=13)
+121 ... 1-й символ
Символы представляют собой простой битмап шириной X и высотой 13, 0-прозрачный
цвет.
Кроме этого, файл ресурсов содержит палитры, признаком которых является размер
768 байт, блоки палитр (цвета A0-CF) - размер 144 байта, и неграфические
ресурсы, в том числе звуковые.
Звуковые ресурсы устроены так:
+0 DB 3
+1 DD 0
+5 DW размер тела ресурса
+7 DW ?
+9 DW ?
+B DW ?
+D ... тело ресурса (XMI-файл или 8-битные звуковые данные)

Вот, собственно, и все...
